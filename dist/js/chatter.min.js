var ChatApp=angular.module("ChatApp",["ngRoute","angularMoment","toaster"]);ChatApp.config(function(a){a.when("/login",{templateUrl:"views/login.html",controller:"HomeController"}).when("/rooms/:user/",{templateUrl:"Views/rooms.html",controller:"RoomsController"}).when("/room/:user/:room/",{templateUrl:"Views/room.html",controller:"RoomController"}).otherwise({redirectTo:"/login"})}),ChatApp.factory("socket",function(a){var b=io.connect("http://localhost:8080");return{on:function(c,d){b.on(c,function(){var c=arguments;a.$apply(function(){d.apply(b,c)})})},emit:function(c,d,e){b.emit(c,d,function(){var c=arguments;a.$apply(function(){e&&e.apply(b,c)})})}}}),ChatApp.controller("HomeController",function(a,b,c,d,e,f){a.username="",a.errorMessage="",a.login=function(c){(void 0===c||13===c.keyCode)&&(""===a.username?f.pop("error","Error!","Please choose a username before continuing!"):e.emit("adduser",a.username,function(c){c?(b.path("/rooms/"+a.username),a.username=""):f.pop("error","Error!","This username is already taken!")}))}}),ChatApp.controller("RoomController",function(a,b,c,d,e,f){a.currentRoom=d.room,a.currentUser=d.user,a.currentTopic="",a.currentUsers=[],a.errorMessage="",a.successMessage="",a.messages=[],a.message="",a.privmsg="",a.privateMessage=[],a.receiver="",a.boolReceiver=!1,a.showprivate=!1,a.showMyMsg=!1,a.showTopic=!1,a.showPw=!1,a.isPassSet=!1;{var g={roomName:a.currentRoom,msg:a.message};({room:a.currentRoom,pass:void 0})}e.emit("rooms"),e.emit("passSetTrueFalse",a.currentRoom),e.on("recPassSetTrueFalse",function(b){a.isPassSet=b}),e.emit("usersInRoom",a.currentRoom),a.createPassword=function(b){if(void 0===b||13===b.keyCode){if(void 0===a.setPW)return void f.pop("error","Error!","Please choose a password!");var c={password:a.setPW,room:a.currentRoom};console.log("passwObj:",c),e.emit("setpassword",c,function(b){b?(a.isPassSet=!0,f.pop("success","Well done!","Successfully changed the password")):f.pop("error","Error!","Could not set password!")}),e.emit("rooms"),a.setPW=""}},a.removePass=function(){var b={password:void 0,room:a.currentRoom};e.emit("removepassword",b,function(b){b?(a.isPassSet=!1,e.emit("rooms"),f.pop("success","Well done!","Successfully removed the password")):f.pop("error","Error!","Could not remove password!")}),a.setPW=""},a.sendMessage=function(b){console.log(a.isPassSet,"<--------------------------"),(void 0===b||13===b.keyCode)&&(a.messageForm.$valid?""!==a.message&&(g.msg=a.message,e.emit("sendmsg",g),a.message=""):f.pop("error","Error!","Your message cannot be longer than 200 characters!"))},a.partRoom=function(){e.emit("partroom",a.currentRoom),b.path("/rooms/"+a.currentUser)},a.showPrivateMsg=function(b){a.showprivate=!0,a.receiver=b},a.sendPrivate=function(b){if(void 0===b||13===b.keyCode){var c={receiver:a.receiver,sender:a.currentUser,message:a.privmsg};a.showMyMsg=!0,e.emit("privatemsg",c,function(a){}),a.privmsg=""}},a.kickUser=function(){var b={user:a.kickedUser,room:a.currentRoom};e.emit("kick",b,function(a,b){a||f.pop("error","Error!",b)})},a.banUser=function(){var b={user:a.bannedUser,room:a.currentRoom};e.emit("ban",b,function(a,b){a||f.pop("error","Error!",b)})},a.unBanUser=function(){var b={user:a.unBannedUser,room:a.currentRoom};e.emit("unban",b,function(a){a?f.pop("success","YES!","Successfully unbanned "+b.user):f.pop("error","Error!","Unban unsuccessfull!")})},a.opUser=function(){var b={user:a.oppedUser,room:a.currentRoom};e.emit("op",b,function(a,b){a||f.pop("error","Error!",b)})},a.deOpUser=function(){var b={user:a.deOppedUser,room:a.currentRoom};e.emit("deop",b,function(a,b){a||f.pop("error","Error!",b)})},a.showPass=function(){a.showPw=!a.showPw},a.showTop=function(){a.showTopic=!a.showTopic},a.setTopic=function(b){if(void 0===b||13===b.keyCode){if(void 0===a.topicName)return void f.pop("error","Error!","Topic cannot be empty!");var c={topic:a.topicName,room:a.currentRoom};e.emit("settopic",c,function(a){a||f.pop("error","Error!","Only admins can set a topic!")}),a.topicName=""}},a.disconnUser=function(){e.emit("disco-nect"),e.emit("users"),b.path("/login")},e.on("rec_notification",function(b){a.currentUser===b.receiver&&f.pop("info","Mail!","You've got mail from "+b.sender)}),e.on("updatechat",function(b,c){a.roomName=b,a.msg=c}),e.on("updateusers",function(b,c,d){a.currentRoom===b&&(a.currentUsers=c),a.op=a.currentUser===d[a.currentUser]?!0:!1}),e.on("kicked",function(c,d,e){a.currentUser===d?b.path("/rooms/"+a.currentUser):a.currentUser===e&&f.pop("success","ROUNDHOUSE!","Successfully kicked "+d)}),e.on("banned",function(c,d,e){a.currentUser===d?b.path("/rooms/"+a.currentUser):a.currentUser===e&&f.pop("success","YES!","Successfully banned "+d)}),e.on("opped",function(b,c,d){a.currentUser===d?f.pop("success","YES!","Successfully opped "+c):a.currentUser===c&&(a.op=!0,f.pop("success","YES!","You were opped by "+d+" CONGRATULATIONS!"))}),e.on("deopped",function(b,c,d){a.currentUser===d?f.pop("success","YES!","Successfully deopped "+c):a.currentUser===c&&(a.op=!1,f.pop("error","NO!","You were deopped by "+d+", SORRY:("))}),e.on("servermessage",function(b,c,d,g){if(d===a.currentUser&&"join"===b&&angular.equals(g,{})){var h={user:a.currentUser,room:a.currentRoom};console.log(h),e.emit("op",h,function(a,b){a||f.pop("error","Error!",b)})}}),e.on("recv_privatemsg",function(b,c){a.boolReceiver=!0,a.username=b,a.privateMessage=c}),e.on("updatetopic",function(b,c){a.currentRoom===b&&(a.currentTopic=c)})}),ChatApp.controller("RoomsController",function(a,b,c,d,e,f){a.rooms={},a.users=[],a.currentUser=d.user,a.showInput=!1,a.errorMessage="",a.roomObj=[],e.on("roomlist",function(b){a.rooms=Object.keys(b)}),e.emit("rooms"),e.emit("users"),a.showInp=function(){a.showInput=!a.showInput},a.createRoom=function(c){if(void 0===c||13===c.keyCode){if(void 0===a.roomName)f.pop("error","Error!","Please choose a room name");else{var d={room:a.roomName,pass:void 0};e.emit("joinroom",d,function(c,e){c?b.path("/room/"+a.currentUser+"/"+d.room):f.pop("error","Error!",e)})}a.roomName=""}},a.joinRoom=function(c,d,g){if(void 0===g||13===g.keyCode){var h={room:c,pass:d};e.emit("joinroom",h,function(c,d){c?b.path("/room/"+a.currentUser+"/"+h.room):f.pop("error","Error!",d)}),a.roomPassword=""}},a.disconnUser=function(){e.emit("disco-nect"),e.emit("users"),b.path("/login")},e.on("roomlist",function(b){a.roomObj=b,a.rooms=Object.keys(b)}),e.on("userlist",function(b){a.users=b}),e.on("servermessage",function(b,c,d){d===a.currentUser&&("kick"===b?f.pop("error","You have been kicked! Out of "+c):"ban"===b&&f.pop("error","NOOOOOOO!","You have been banned! From "+c))})});