angular.module("ChatApp",["ngRoute","angularMoment","toaster"]),angular.module("ChatApp").config(function(a){a.when("/login",{templateUrl:"views/login.html",controller:"HomeController"}).when("/rooms/:user/",{templateUrl:"Views/rooms.html",controller:"RoomsController"}).when("/room/:user/:room/",{templateUrl:"Views/room.html",controller:"RoomController"}).otherwise({redirectTo:"/login"})}),angular.module("ChatApp").factory("socket",["$rootScope",function(a){var b=io.connect("http://localhost:8080");return{on:function(c,d){b.on(c,function(){var c=arguments;a.$apply(function(){d.apply(b,c)})})},emit:function(c,d,e){b.emit(c,d,function(){var c=arguments;a.$apply(function(){e&&e.apply(b,c)})})}}}]),angular.module("ChatApp").controller("HomeController",["$scope","$location","socket","toaster",function(a,b,c,d){a.username="",a.errorMessage="",a.login=function(e){(void 0===e||13===e.keyCode)&&(""===a.username?d.pop("error","Error!","Please choose a username before continuing!"):c.emit("adduser",a.username,function(c){c?(b.path("/rooms/"+a.username),a.username=""):d.pop("error","Error!","This username is already taken!")}))}}]),angular.module("ChatApp").controller("RoomController",["$scope","$location","$routeParams","socket","toaster",function(a,b,c,d,e){a.currentRoom=c.room,a.currentUser=c.user,a.currentTopic="",a.currentUsers=[],a.errorMessage="",a.successMessage="",a.messages=[],a.message="",a.privmsg="",a.privateMessage=[],a.receiver="",a.boolReceiver=!1,a.showprivate=!1,a.showMyMsg=!1,a.showTopic=!1,a.showPw=!1,a.isPassSet=!1,a.isTopicSet=!1,d.emit("rooms"),d.emit("newUser",a.currentRoom),d.emit("passSetTrueFalse",a.currentRoom),d.on("recPassSetTrueFalse",function(b){a.isPassSet=b}),a.createPassword=function(b){if(void 0===b||13===b.keyCode){if(void 0===a.setPW)return void e.pop("error","Error!","Please choose a password!");var c={password:a.setPW,room:a.currentRoom};d.emit("setpassword",c,function(b){b?(a.isPassSet=!0,e.pop("success","Well done!","Successfully changed the password")):e.pop("error","Error!","Could not set password!")}),d.emit("rooms")}},a.removePass=function(){var b={password:void 0,room:a.currentRoom};d.emit("removepassword",b,function(b){b?(a.isPassSet=!1,d.emit("rooms"),e.pop("success","Well done!","Successfully removed the password")):e.pop("error","Error!","Could not remove password!")}),a.showPw=!1,a.setPW=void 0},a.sendMessage=function(b){if(void 0===b||13===b.keyCode)if(a.messageForm.$valid){if(""!==a.message){var c={roomName:a.currentRoom,msg:a.message};d.emit("sendmsg",c),a.message=""}}else e.pop("error","Error!","Your message cannot be longer than 200 characters!")},a.partRoom=function(){d.emit("partroom",a.currentRoom),b.path("/rooms/"+a.currentUser)},a.showPrivateMsg=function(b){a.showprivate=!0,a.receiver=b},a.sendPrivate=function(b){if(void 0===b||13===b.keyCode){var c={receiver:a.receiver,sender:a.currentUser,message:a.privmsg};a.showMyMsg=!0,d.emit("privatemsg",c,function(a){a||e.pop("error","Error!","Sending message failed!")}),a.privmsg=""}},a.kickUser=function(b){var c={user:b,room:a.currentRoom};d.emit("kick",c,function(a,b){a||e.pop("error","Error!",b)})},a.banUser=function(b){console.log(b);var c={user:b,room:a.currentRoom};d.emit("ban",c,function(a,b){a||e.pop("error","Error!",b)})},a.unBanUser=function(b){var c={user:b,room:a.currentRoom};d.emit("unban",c,function(a){a?e.pop("success","YES!","Successfully unbanned "+c.user):e.pop("error","Error!","Unban unsuccessfull!")}),d.emit("newUser",a.currentRoom)},a.opUser=function(b){var c={user:b,room:a.currentRoom};d.emit("op",c,function(a,b){a||e.pop("error","Error!",b)})},a.deOpUser=function(b){var c={user:b,room:a.currentRoom};d.emit("deop",c,function(a,b){a||e.pop("error","Error!",b)})},a.showPass=function(){a.showPw=!a.showPw},a.showTop=function(){a.showTopic=!a.showTopic,a.isTopicSet=!0},a.setTopic=function(b){if(void 0===b||13===b.keyCode){if(void 0===a.topicName)return void e.pop("error","Error!","Topic cannot be empty!");var c={topic:a.topicName,room:a.currentRoom};d.emit("settopic",c,function(a){a||e.pop("error","Error!","Only admins can set a topic!")}),a.topicName="",a.isTopicSet=!1,a.showTopic=!1}},a.disconnUser=function(){d.emit("disco-nect"),d.emit("users"),b.path("/login")},d.on("rec_notification",function(b){a.currentUser===b.receiver&&e.pop("info","Mail!","You've got mail from "+b.sender)}),d.on("updatechat",function(b,c){a.roomName=b,a.msg=c}),d.on("updateusers",function(b,c,d,e){a.currentRoom===b&&(a.currentUsers=c),a.op=a.currentUser===d[a.currentUser]?!0:!1,a.ops=d,a.banned=e}),d.on("kicked",function(c,d,f){a.currentUser===d?b.path("/rooms/"+a.currentUser):a.currentUser===f&&e.pop("success","ROUNDHOUSE!","Successfully kicked "+d)}),d.on("banned",function(c,d,f){a.currentUser===d?b.path("/rooms/"+a.currentUser):a.currentUser===f&&e.pop("success","YES!","Successfully banned "+d)}),d.on("opped",function(b,c,d){a.currentUser===d?e.pop("success","YES!","Successfully opped "+c):a.currentUser===c&&(a.op=!0,e.pop("success","YES!","You were opped by "+d+" CONGRATULATIONS!"))}),d.on("deopped",function(b,c,d){a.currentUser===d?e.pop("success","YES!","Successfully deopped "+c):a.currentUser===c&&(a.op=!1,e.pop("error","NO!","You were deopped by "+d+", SORRY:("))}),d.on("servermessage",function(b,c,f,g){if(f===a.currentUser&&"join"===b&&angular.equals(g,{})){var h={user:a.currentUser,room:a.currentRoom};d.emit("op",h,function(a,b){a||e.pop("error","Error!",b)})}}),d.on("recv_privatemsg",function(b,c){a.boolReceiver=!0,a.username=b,a.privateMessage=c}),d.on("updatetopic",function(b,c){a.currentRoom===b&&(a.currentTopic=c)})}]),angular.module("ChatApp").controller("RoomsController",["$scope","$location","$routeParams","socket","toaster",function(a,b,c,d,e){a.rooms={},a.users=[],a.currentUser=c.user,a.showInput=!1,a.errorMessage="",a.roomObj=[],d.emit("rooms"),d.emit("users"),a.showInp=function(){a.showInput=!a.showInput},a.createRoom=function(c){if(void 0===c||13===c.keyCode){if(void 0===a.roomName)e.pop("error","Error!","Please choose a room name");else{var f={room:a.roomName,pass:void 0};d.emit("joinroom",f,function(c,d){c?b.path("/room/"+a.currentUser+"/"+f.room):e.pop("error","Error!",d)})}a.roomName=""}},a.joinRoom=function(c,f,g){if(void 0===g||13===g.keyCode){var h={room:c,pass:f};d.emit("joinroom",h,function(c,d){c?b.path("/room/"+a.currentUser+"/"+h.room):e.pop("error","Error!",d)}),a.roomPassword=""}},a.disconnUser=function(){d.emit("disco-nect"),d.emit("users"),b.path("/login")},d.on("roomlist",function(b){a.rooms=Object.keys(b),a.roomObj=b}),d.on("userlist",function(b){a.users=b}),d.on("servermessage",function(b,c,d){d===a.currentUser&&("kick"===b?e.pop("error","ROUNDHOUSE!","You have been kicked! Out of "+c):"ban"===b&&e.pop("error","NOOOOOOO!","You have been banned! From "+c))})}]);